<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SPSS Connect â€” Add Record</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
  <script type="importmap">
  {
    "imports": {
      "firebase/app": "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js",
      "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js",
      "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js",
      "firebase/storage": "https://www.gstatic.com/firebasejs/10.12.0/firebase-storage.js"
    }
  }
  </script>
</head>
<body>

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>
    <p>Saving...</p>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" class="toast-container-spss"></div>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-spss">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="/"><img src="assets/logo.png" alt="SPSS" class="navbar-logo">SPSS Connect</a>
      <div class="d-flex align-items-center gap-2 ms-auto">
        <!-- Language Toggle -->
        <div class="lang-toggle">
          <button class="lang-btn active" id="langEN" data-lang="en">EN</button>
          <button class="lang-btn" id="langML" data-lang="ml">ML</button>
        </div>
        <!-- Admin-only nav (visible only when logged in as admin) -->
        <div id="authNav" class="d-flex align-items-center gap-2 d-none">
          <a href="admin-dashboard" class="btn btn-outline-light btn-sm"><i class="bi bi-grid-1x2 me-1"></i>Dashboard</a>
          <span class="text-light small" id="userEmail"></span>
          <button class="btn btn-outline-light btn-sm" id="logoutBtn">Logout</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container py-4">
    <h2 class="mb-4" data-i18n="page.title">Add New Record</h2>

    <form id="memberForm" novalidate>

      <!-- Personal Details -->
      <div class="form-section">
        <h4 class="form-section-title" data-i18n="section.personalDetails">Personal Details (House Owner)</h4>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label" data-i18n="form.name">Name</label>
            <input type="text" class="form-control" id="ownerName" required>
            <div class="invalid-feedback" data-i18n="validation.nameRequired">Name is required</div>
          </div>
          <div class="col-md-6">
            <label class="form-label" data-i18n="form.houseName">House Name</label>
            <input type="text" class="form-control" id="houseName" required>
            <div class="invalid-feedback" data-i18n="validation.houseNameRequired">House name is required</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.dob">Date of Birth</label>
            <input type="date" class="form-control" id="ownerDOB" required>
            <div class="invalid-feedback" data-i18n="validation.dobRequired">Date of birth is required</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.gender">Gender</label>
            <select class="form-select" id="ownerGender" required>
              <option value="" data-i18n="form.selectOption">Select...</option>
              <option value="male" data-i18n="option.male">Male</option>
              <option value="female" data-i18n="option.female">Female</option>
              <option value="other" data-i18n="option.other">Other</option>
            </select>
            <div class="invalid-feedback" data-i18n="validation.genderRequired">Gender is required</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.phone">Phone</label>
            <input type="tel" class="form-control digits-only" id="ownerPhone" inputmode="numeric" pattern="[0-9]*" maxlength="10" required>
            <div class="invalid-feedback" data-i18n="validation.phoneInvalid">Enter a valid 10-digit phone</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.email">Email</label>
            <input type="email" class="form-control" id="ownerEmail">
            <div class="invalid-feedback" data-i18n="validation.emailInvalid">Enter a valid email</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.bloodGroup">Blood Group</label>
            <select class="form-select" id="ownerBloodGroup" required>
              <option value="" data-i18n="form.selectOption">Select...</option>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
            <div class="invalid-feedback" data-i18n="validation.bloodGroupRequired">Blood group is required</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.education">Highest Education</label>
            <select class="form-select" id="ownerEducation" required>
              <option value="" data-i18n="form.selectOption">Select...</option>
              <option value="below_10th" data-i18n="option.below10th">Below 10th</option>
              <option value="10th" data-i18n="option.tenth">10th</option>
              <option value="plus_two" data-i18n="option.plusTwo">Plus Two</option>
              <option value="diploma" data-i18n="option.diploma">Diploma</option>
              <option value="bachelors" data-i18n="option.bachelors">Bachelor's Degree</option>
              <option value="masters" data-i18n="option.masters">Master's Degree</option>
              <option value="doctorate" data-i18n="option.doctorate">Doctorate</option>
              <option value="professional" data-i18n="option.professional">Professional</option>
              <option value="other" data-i18n="option.otherEdu">Other</option>
            </select>
            <div class="invalid-feedback" data-i18n="validation.educationRequired">Education is required</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.occupation">Occupation</label>
            <select class="form-select" id="ownerOccupation" required>
              <option value="" data-i18n="form.selectOption">Select...</option>
              <option value="central_govt" data-i18n="option.centralGovt">Central Government Employee</option>
              <option value="state_govt" data-i18n="option.stateGovt">State Government Employee</option>
              <option value="private_employee" data-i18n="option.privateEmployee">Private Employee</option>
              <option value="self_employed" data-i18n="option.selfEmployed">Self-Employed</option>
              <option value="kazhakam" data-i18n="option.kazhakam">Kazhakam</option>
              <option value="homemaker" data-i18n="option.homemaker">Homemaker</option>
              <option value="retired" data-i18n="option.retired">Retired</option>
              <option value="unemployed" data-i18n="option.unemployed">Unemployed</option>
            </select>
            <div class="invalid-feedback" data-i18n="validation.occupationRequired">Occupation is required</div>
          </div>
          <div class="col-md-3 d-none" id="ownerExpertiseGroup">
            <label class="form-label" data-i18n="form.areaOfExpertise">Area of Expertise</label>
            <input type="text" class="form-control" id="ownerExpertise">
          </div>

          <!-- Photo Upload (controlled by ENABLE_PHOTO_UPLOAD) -->
          <div class="col-md-6 d-none" id="photoSection">
            <label class="form-label" data-i18n="form.photo">Photo</label>
            <div class="photo-upload-area" id="photoDropArea">
              <i class="bi bi-camera fs-3 text-muted"></i>
              <p class="small text-muted mb-0" data-i18n="form.photoHint">Click or drag to upload photo</p>
              <input type="file" class="d-none" id="photoInput" accept="image/*">
              <img id="photoPreview" class="photo-preview d-none" alt="Preview">
            </div>
          </div>
        </div>
      </div>

      <!-- Membership Details -->
      <div class="form-section">
        <h4 class="form-section-title" data-i18n="section.membershipDetails">Membership Details</h4>
        <div class="row g-3">
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.pradeshikaSabha">Pradeshika Sabha</label>
            <select class="form-select" id="pradeshikaSabha" required>
              <option value="" data-i18n="form.selectOption">Select...</option>
              <option value="Ernakulam" data-i18n="option.ernakulam">Ernakulam</option>
              <option value="Edappally" data-i18n="option.edappally">Edappally</option>
              <option value="Tripunithura" data-i18n="option.tripunithura">Tripunithura</option>
              <option value="Chottanikkara" data-i18n="option.chottanikkara">Chottanikkara</option>
              <option value="Perumbavoor" data-i18n="option.perumbavoor">Perumbavoor</option>
              <option value="Aluva" data-i18n="option.aluva">Aluva</option>
              <option value="Panangad" data-i18n="option.panangad">Panangad</option>
            </select>
            <div class="invalid-feedback" data-i18n="validation.sabhaRequired">Pradeshika Sabha is required</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.membership">Membership</label>
            <select class="form-select" id="ownerMembership" required>
              <option value="" data-i18n="form.selectOption">Select...</option>
              <option value="life_member" data-i18n="option.lifeMember">Life Member</option>
              <option value="ordinary_member" data-i18n="option.ordinaryMember">Ordinary Member</option>
            </select>
            <div class="invalid-feedback" data-i18n="validation.membershipRequired">Membership type is required</div>
          </div>
          <div class="col-md-3">
            <label class="form-label" data-i18n="form.holdsSpssPosition">Do you hold any position in SPSS?</label>
            <select class="form-select" id="holdsSpssPosition">
              <option value="no" data-i18n="option.no">No</option>
              <option value="yes" data-i18n="option.yes">Yes</option>
            </select>
          </div>
          <div class="col-md-3 d-none" id="spssPositionNameGroup">
            <label class="form-label" data-i18n="form.spssPositionName">Position Name</label>
            <input type="text" class="form-control" id="spssPositionName">
            <div class="invalid-feedback" data-i18n="validation.positionNameRequired">Please enter the position name</div>
          </div>
        </div>
      </div>

      <!-- Address -->
      <div class="form-section">
        <h4 class="form-section-title" data-i18n="section.address">Address</h4>
        <div class="row g-3">
          <div class="col-md-6">
            <label class="form-label" data-i18n="form.address1">Address Line 1</label>
            <input type="text" class="form-control" id="address1" required>
            <div class="invalid-feedback" data-i18n="validation.address1Required">Address Line 1 is required</div>
          </div>
          <div class="col-md-6">
            <label class="form-label" data-i18n="form.address2">Address Line 2</label>
            <input type="text" class="form-control" id="address2">
          </div>
          <div class="col-md-6">
            <label class="form-label" data-i18n="form.place">Place</label>
            <input type="text" class="form-control" id="place" required>
            <div class="invalid-feedback" data-i18n="validation.placeRequired">Place is required</div>
          </div>
          <div class="col-md-6">
            <label class="form-label" data-i18n="form.pin">PIN Code</label>
            <input type="tel" class="form-control digits-only" id="pin" inputmode="numeric" pattern="[0-9]*" maxlength="6" required>
            <div class="invalid-feedback" data-i18n="validation.pinInvalid">Enter a valid 6-digit PIN</div>
          </div>
        </div>
      </div>

      <!-- Family -->
      <div class="form-section">
        <h4 class="form-section-title" data-i18n="section.healthFamily">Family & Welfare</h4>
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label" data-i18n="form.healthInsurance">Do you have health insurance for your family?</label>
            <div class="d-flex gap-3 mt-1">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="healthInsurance" id="healthYes" value="true">
                <label class="form-check-label" for="healthYes" data-i18n="option.yes">Yes</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="healthInsurance" id="healthNo" value="false" checked>
                <label class="form-check-label" for="healthNo" data-i18n="option.no">No</label>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label" data-i18n="form.termLifeInsurance">Do you have term/life insurance?</label>
            <div class="d-flex gap-3 mt-1">
              <div class="form-check">
                <input class="form-check-input" type="radio" name="termLifeInsurance" id="termLifeYes" value="true">
                <label class="form-check-label" for="termLifeYes" data-i18n="option.yes">Yes</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="termLifeInsurance" id="termLifeNo" value="false" checked>
                <label class="form-check-label" for="termLifeNo" data-i18n="option.no">No</label>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <label class="form-label" data-i18n="form.rationCardType">Ration Card Color</label>
            <select class="form-select" id="rationCardType" required>
              <option value="" data-i18n="form.selectOption">Select...</option>
              <option value="none" data-i18n="option.rationNone">No Ration Card</option>
              <option value="white" data-i18n="option.rationWhite">White</option>
              <option value="yellow" data-i18n="option.rationYellow">Yellow</option>
              <option value="blue" data-i18n="option.rationBlue">Blue</option>
              <option value="pink" data-i18n="option.rationPink">Pink</option>
            </select>
            <div class="invalid-feedback" data-i18n="validation.rationCardRequired">Ration card color is required</div>
          </div>
        </div>
      </div>

      <!-- Members Section -->
      <div class="form-section member-section">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="form-section-title mb-0" data-i18n="section.members">Member Details</h4>
          <button type="button" class="btn btn-outline-primary btn-sm" id="addMemberBtn">
            <i class="bi bi-plus-lg me-1"></i><span data-i18n="btn.addMember">Add Member</span>
          </button>
        </div>
        <div id="membersContainer"></div>
        <p class="text-muted small" id="noMembersMsg" data-i18n="form.noMembers">No members added yet. Click "Add Member" to begin.</p>
      </div>

      <!-- Non-Members Section -->
      <div class="form-section non-member-section">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="form-section-title mb-0" data-i18n="section.nonMembers">Non-Member Details</h4>
          <button type="button" class="btn btn-outline-secondary btn-sm" id="addNonMemberBtn">
            <i class="bi bi-plus-lg me-1"></i><span data-i18n="btn.addNonMember">Add Non-Member</span>
          </button>
        </div>
        <div id="nonMembersContainer"></div>
        <p class="text-muted small" id="noNonMembersMsg" data-i18n="form.noNonMembers">No non-members added yet. Click "Add Non-Member" to begin.</p>
      </div>

      <!-- Submit -->
      <div class="d-flex gap-2 mb-5">
        <button type="submit" class="btn btn-primary px-4 py-2" id="submitBtn">
          <i class="bi bi-check-lg me-1"></i><span data-i18n="btn.submit">Save Record</span>
        </button>
        <button type="button" onclick="history.back()" class="btn btn-outline-secondary px-4 py-2" data-i18n="btn.cancel">Cancel</button>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="js/app-init.js"></script>
</body>
</html>
